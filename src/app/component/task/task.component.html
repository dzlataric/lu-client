<mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
<div class="form-flex" *ngIf="task !== undefined" [formGroup]="form">
    <mat-card>
        <mat-card-title>
            {{task.name}}
        </mat-card-title>
        <br><br>
        <mat-card-content>
            <div *ngFor="let field of task.formFields; let i = index;">
                <div [ngSwitch]="field.type.name">

                    <div *ngSwitchCase="'file'">
                        <label for="file">{{field.label}}</label>
                        <br>
                        <input type="file" id="file" (change)="handleFileInput($any($event.target).files)">
                    </div>

                    <br>
                    <mat-checkbox *ngSwitchCase="'boolean'" [formControlName]="field.id" labelPosition="before" color="primary">
                        {{field.label}}:
                    </mat-checkbox>

                    <mat-form-field *ngSwitchCase="'enum'">
                        <mat-label>{{field.label}}</mat-label>
                        <mat-select [formControlName]="field.id">
                            <mat-option *ngFor="let item of field.type.values | keyvalue" [value]="item.key">
                                {{item.value}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="form.get(field.id).invalid && (form.get(field.id).dirty || form.get(field.id).touched)">
                            <div *ngIf="form.get(field.id).errors.required"> {{field.label}} are required</div>
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field *ngSwitchCase="'collection'">
                        <mat-label>{{field.label}}</mat-label>
                        <div *ngFor="let item of field.type.values | keyvalue">
                            <span> {{item.key}} </span>
                            <input matInput>
                        </div>
                        <mat-error *ngIf="form.get(field.id).invalid && (form.get(field.id).dirty || form.get(field.id).touched)">
                            <div *ngIf="form.get(field.id).errors.required"> {{field.label}} are required</div>
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field *ngSwitchDefault>
                        <mat-label>{{field.label}}</mat-label>
                        <input matInput [formControlName]="field.id">
                        <mat-error *ngIf="form.get(field.id).invalid && (form.get(field.id).dirty || form.get(field.id).touched)">
                            <div *ngIf="form.get(field.id).errors.required"> {{field.label}} is required</div>
                            <div *ngIf="!form.get(field.id).errors.required && (form.get(field.id).errors.minlength || form.get(field.id).errors.maxlength)">
                                Field {{field.label}} length is invalid
                            </div>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </mat-card-content>
        <mat-card-actions>
            <div class="button-flex-container">
                <button mat-raised-button color="primary" [disabled]="form.invalid || (fileUploadNeeded && fileToUpload == null)"
                        (click)="submitForm(task)">Complete
                </button>
            </div>
        </mat-card-actions>
    </mat-card>
</div>
